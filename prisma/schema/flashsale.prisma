enum FlashSaleStatus {
  UPCOMING
  ACTIVE
  ENDED
  CANCELLED
}

model FlashSale {
  id          String          @id @default(uuid())
  name        String          @db.VarChar(255)
  description String?         @db.Text
  slug        String          @unique @db.VarChar(255)
  banner      String?         @db.VarChar(500)
  startTime   DateTime        @map("start_time")
  endTime     DateTime        @map("end_time")
  status      FlashSaleStatus @default(UPCOMING)
  isActive    Boolean         @default(true) @map("is_active")
  sortOrder   Int             @default(0) @map("sort_order")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  products FlashSaleProduct[]
  orders   FlashSaleOrder[]

  @@index([slug])
  @@index([startTime])
  @@index([endTime])
  @@index([status])
  @@index([isActive])
  @@map("flash_sales")
}

model FlashSaleProduct {
  id            String   @id @default(uuid())
  flashSaleId   String   @map("flash_sale_id")
  productId     String   @map("product_id")
  variantId     String?  @map("variant_id")
  flashPrice    Decimal  @map("flash_price") @db.Decimal(10, 2)
  originalPrice Decimal  @map("original_price") @db.Decimal(10, 2)
  maxQuantity   Int      @map("max_quantity")
  soldQuantity  Int      @default(0) @map("sold_quantity")
  limitPerOrder Int      @default(1) @map("limit_per_order")
  sortOrder     Int      @default(0) @map("sort_order")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  flashSale FlashSale       @relation(fields: [flashSaleId], references: [id], onDelete: Cascade)
  product   Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant   ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([flashSaleId, productId, variantId])
  @@index([flashSaleId])
  @@index([productId])
  @@index([variantId])
  @@index([isActive])
  @@map("flash_sale_products")
}

model FlashSaleOrder {
  id          String   @id @default(uuid())
  flashSaleId String   @map("flash_sale_id")
  orderId     String   @unique @map("order_id")
  createdAt   DateTime @default(now()) @map("created_at")

  flashSale FlashSale @relation(fields: [flashSaleId], references: [id], onDelete: Cascade)
  order     Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([flashSaleId])
  @@index([orderId])
  @@map("flash_sale_orders")
}
