model Promotion {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(255)
  description String?  @db.Text
  type        String   @db.VarChar(50)
  value       Decimal  @db.Decimal(10, 2)
  minPurchase Decimal? @map("min_purchase") @db.Decimal(10, 2)
  maxDiscount Decimal? @map("max_discount") @db.Decimal(10, 2)
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  products PromotionProduct[]

  @@index([startDate])
  @@index([endDate])
  @@index([isActive])
  @@map("promotions")
}

model PromotionProduct {
  id          String   @id @default(uuid())
  promotionId String   @map("promotion_id")
  productId   String   @map("product_id")
  createdAt   DateTime @default(now()) @map("created_at")

  promotion Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([promotionId, productId])
  @@index([promotionId])
  @@index([productId])
  @@map("promotion_products")
}

model Coupon {
  id          String   @id @default(uuid())
  code        String   @unique @db.VarChar(50)
  type        String   @db.VarChar(50)
  value       Decimal  @db.Decimal(10, 2)
  minPurchase Decimal? @map("min_purchase") @db.Decimal(10, 2)
  maxDiscount Decimal? @map("max_discount") @db.Decimal(10, 2)
  usageLimit  Int?     @map("usage_limit")
  usedCount   Int      @default(0) @map("used_count")
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  usages CouponUsage[]

  @@index([code])
  @@index([startDate])
  @@index([endDate])
  @@index([isActive])
  @@map("coupons")
}

model CouponUsage {
  id        String   @id @default(uuid())
  couponId  String   @map("coupon_id")
  orderId   String   @unique @map("order_id")
  discount  Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at")

  coupon Coupon @relation(fields: [couponId], references: [id], onDelete: Cascade)
  order  Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([orderId])
  @@map("coupon_usages")
}
