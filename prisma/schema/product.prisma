enum CateGoryType {
  BRAND
  CATEGORY
}

model Category {
  id           String       @id @default(uuid())
  name         String       @db.VarChar(255)
  slug         String       @unique @db.VarChar(255)
  description  String?      @db.Text
  imageMediaId String?      @map("image_media_id")
  parentId     String?      @map("parent_id")
  isActive     Boolean      @default(true) @map("is_active")
  sortOrder    Int          @default(0) @map("sort_order")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  brandId      String?      @map("brand_id")
  type         CateGoryType @default(CATEGORY)

  parent            Category?         @relation("CategoryTree", fields: [parentId], references: [id], onDelete: SetNull)
  children          Category[]        @relation("CategoryTree")
  imageMedia        Media?            @relation("CategoryImage", fields: [imageMediaId], references: [id], onDelete: SetNull)
  brand             Brand?            @relation("BrandCategory", fields: [brandId], references: [id], onDelete: SetNull)
  productCategories ProductCategory[]

  @@index([slug])
  @@index([parentId])
  @@index([imageMediaId])
  @@map("categories")
}

model Brand {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(255)
  slug        String   @unique @db.VarChar(255)
  description String?  @db.Text
  logoMediaId String?  @map("logo_media_id")
  website     String?  @db.VarChar(500)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  products   Product[]
  logoMedia  Media?     @relation("BrandLogo", fields: [logoMediaId], references: [id], onDelete: SetNull)
  categories Category[] @relation("BrandCategory")

  @@index([slug])
  @@index([logoMediaId])
  @@map("brands")
}

model Product {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(255)
  slug         String   @unique @db.VarChar(255)
  description  String?  @db.Text
  shortDesc    String?  @map("short_desc") @db.VarChar(500)
  sku          String   @unique @db.VarChar(100)
  brandId      String?  @map("brand_id")
  basePrice    Decimal  @map("base_price") @db.Decimal(10, 2)
  comparePrice Decimal? @map("compare_price") @db.Decimal(10, 2)
  isActive     Boolean  @default(true) @map("is_active")
  isFeatured   Boolean  @default(false) @map("is_featured")
  weight       Decimal? @db.Decimal(8, 2)
  metaTitle    String?  @map("meta_title") @db.VarChar(255)
  metaDesc     String?  @map("meta_desc") @db.Text
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  brand             Brand?             @relation(fields: [brandId], references: [id], onDelete: SetNull)
  badges            ProductBadge[]
  variants          ProductVariant[]
  images            ProductImage[]
  reviews           ProductReview[]
  orderItems        OrderItem[]
  cartItems         CartItem[]
  promotions        PromotionProduct[]
  commRates         CommissionRate[]
  flashSaleProducts FlashSaleProduct[]
  productCategories ProductCategory[]
  stats             ProductStats?

  @@index([slug])
  @@index([brandId])
  @@index([sku])
  @@map("products")
}

enum ProductBadgeType {
  NEW
  SALE
  BEST_SELLER
  FREESHIPPING
}

enum ProductBadgeVariant {
  PRIMARY
  INFO
  NEUTRAL
}

model ProductBadge {
  id        String              @id @default(uuid())
  productId String              @map("product_id")
  name      String              @db.VarChar(255)
  sortOrder Int                 @default(0) @map("sort_order")
  isActive  Boolean             @default(true) @map("is_active")
  variant   ProductBadgeVariant @default(INFO)
  type      ProductBadgeType    @default(NEW)
  createdAt DateTime            @default(now()) @map("created_at")
  updatedAt DateTime            @updatedAt @map("updated_at")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_badges")
}

model ProductVariant {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  sku       String   @unique @db.VarChar(100)
  name      String   @db.VarChar(255)
  color     String?  @db.VarChar(100)
  size      String?  @db.VarChar(100)
  type      String?  @db.VarChar(100)
  price     Decimal  @db.Decimal(10, 2)
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  product           Product            @relation(fields: [productId], references: [id], onDelete: Cascade)
  inventory         ProductInventory?
  images            ProductImage[]
  orderItems        OrderItem[]
  cartItems         CartItem[]
  flashSaleProducts FlashSaleProduct[]

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model ProductImage {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  variantId String?  @map("variant_id")
  mediaId   String   @map("media_id")
  alt       String?  @db.VarChar(255)
  sortOrder Int      @default(0) @map("sort_order")
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")

  product Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)
  media   Media           @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([mediaId])
  @@index([variantId])
  @@map("product_images")
}

enum ProductInventoryDisplayStatus {
  IN_STOCK
  OUT_OF_STOCK
}

model ProductInventory {
  id                String                        @id @default(uuid())
  variantId         String                        @unique @map("variant_id")
  quantity          Int                           @default(0)
  displayStatus     ProductInventoryDisplayStatus @default(IN_STOCK) @map("display_status")
  lowStockThreshold Int                           @default(10) @map("low_stock_threshold")
  createdAt         DateTime                      @default(now()) @map("created_at")
  updatedAt         DateTime                      @updatedAt @map("updated_at")

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([variantId])
  @@map("product_inventory")
}

model ProductCategory {
  id         String   @id @default(uuid())
  productId  String   @map("product_id")
  categoryId String   @map("category_id")
  createdAt  DateTime @default(now()) @map("created_at")

  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
  @@map("product_categories")
}
