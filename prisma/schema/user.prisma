model User {
  id            String   @id @default(uuid())
  email         String   @unique
  firstName     String   @map("first_name") @db.VarChar(255)
  lastName      String   @map("last_name") @db.VarChar(255)
  phone         String   @unique
  username      String   @unique
  password      String   @db.VarChar(255)
  avatarMediaId String?  @map("avatar_media_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  refreshToken  String?  @map("refresh_token")

  isActive        Boolean              @default(true) @map("is_active")
  isVerified      Boolean              @default(false) @map("is_verified")
  isBanned        Boolean              @default(false) @map("is_banned")
  isDeleted       Boolean              @default(false) @map("is_deleted")
  isEmailVerified Boolean              @default(false) @map("is_email_verified")
  isPhoneVerified Boolean              @default(false) @map("is_phone_verified")
  emailVerifiedAt DateTime?            @map("email_verified_at")
  phoneVerifiedAt DateTime?            @map("phone_verified_at")
  // Relations
  cart            Cart?
  orders          Order[]
  reviews         ProductReview[]
  addresses       Address[]
  affiliate       Affiliate?
  roleAssignments UserRoleAssignment[]
  avatarMedia     Media?               @relation("UserAvatar", fields: [avatarMediaId], references: [id], onDelete: SetNull)
  uploadedMedia   Media[]              @relation("UserUploadedMedia")

  @@index([email])
  @@index([phone])
  @@index([username])
  @@index([avatarMediaId])
  @@map("users")
}

model UserRole {
  id        String   @id @default(uuid())
  name      String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  roleAssignments UserRoleAssignment[]

  @@index([name])
  @@map("user_roles")
}

model UserRoleAssignment {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  roleId    String   @map("role_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role UserRole @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_role_assignments")
}
