model Affiliate {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  code            String   @unique @db.VarChar(50)
  status          String   @default("pending") @db.VarChar(50)
  totalEarnings   Decimal  @default(0) @map("total_earnings") @db.Decimal(10, 2)
  paidEarnings    Decimal  @default(0) @map("paid_earnings") @db.Decimal(10, 2)
  pendingEarnings Decimal  @default(0) @map("pending_earnings") @db.Decimal(10, 2)
  bankAccount     String?  @map("bank_account") @db.VarChar(255)
  bankName        String?  @map("bank_name") @db.VarChar(255)
  accountHolder   String?  @map("account_holder") @db.VarChar(255)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  user        User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  links       AffiliateLink[]
  commissions AffiliateCommission[]

  @@index([code])
  @@index([userId])
  @@map("affiliates")
}

model AffiliateLink {
  id          String   @id @default(uuid())
  affiliateId String   @map("affiliate_id")
  productId   String?  @map("product_id")
  url         String   @db.VarChar(500)
  clicks      Int      @default(0)
  conversions Int      @default(0) @map("conversions")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  affiliate Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([productId])
  @@map("affiliate_links")
}

model AffiliateCommission {
  id          String    @id @default(uuid())
  affiliateId String    @map("affiliate_id")
  orderId     String    @map("order_id")
  amount      Decimal   @db.Decimal(10, 2)
  rate        Decimal   @db.Decimal(5, 2)
  status      String    @default("pending") @db.VarChar(50)
  paidAt      DateTime? @map("paid_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  affiliate Affiliate @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  order     Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([orderId])
  @@index([status])
  @@map("affiliate_commissions")
}

model CommissionRate {
  id         String   @id @default(uuid())
  productId  String?  @map("product_id")
  categoryId String?  @map("category_id")
  rate       Decimal  @db.Decimal(5, 2)
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  product Product? @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([categoryId])
  @@map("commission_rates")
}
